define("file-widget-1:image/util/thumbnailPic/thumbnailPicList.tpl.js",function(i,e,t){var s=[];s.push("<%for (var i=0; i<list.length; i++){%>"),s.push("<% var item = list[i]%>"),s.push('<li node-type="thumb-item" class="thumb-item <%if(item.index==index){%>current<%}%>">'),s.push('<img node-type="slider-item" class="slider-item" data-index=<%=item.index%> src="<%=item.thumbUrl%>"></img>'),s.push("</li>"),s.push("<%}%>"),t.exports=s.join("")});
;define("file-widget-1:image/util/picPreviewService/picPreviewService.js",function(t,e,i){var n=t("base:widget/libs/jquerypacket.js"),o=t("base:widget/storage/storage.js"),r=t("base:widget/libs/underscore.js"),a={HTTPVersion:"1.1",normalDomains:[],thumbsDomains:[]},s={checkHttpVersion:function(){function t(){u.isReady=!0,r.isFunction(u.callback)&&u.callback()}for(var e=!1,i=(XMLHttpRequest&&"withCredentials"in XMLHttpRequest.prototype),s="thumbs_hv",u={isReady:!1},c=0;10>c;c++)a.normalDomains.push("d"+c+".pcs.baidu.com"),a.thumbsDomains.push("thumbnail"+c+".baidupcs.com");if(e||!i)return void t();var h=o.getItem(s);return h?(a.HTTPVersion=h,void t()):void n.getJSON("https://thumbnail10.baidupcs.com/httpv").fail(function(){o.setItem(s,"1.1")}).done(function(t){o.setItem(s,t.version),a.HTTPVersion=t.version}).always(function(){t()})},getIdleDomain:function(t){var e=0,i="normalDomains",n="thumbsDomains";if(t&&"2"===String(a.HTTPVersion))return"https://thumbnail10.baidupcs.com";var o=t?n:i;return a[o][e++%10]},getProcessedSrc:function(t,e){if(t.indexOf("http")<0)return t;var i="pcs.baidu.com",n="d.pcs.baidu.com",o="thumbnail0.baidupcs.com",r="http:"===document.location.protocol;if(null!=t){var a=t.indexOf(n)>-1,u=t.indexOf(o)>-1;if(!a&&!u)return t;var c=a?n:o,h=n;return a&&r&&(h=s.getIdleDomain()),u&&(h=s.getIdleDomain(!0)),e&&(h=location.protocol+"//"+i),c!==h&&((h.indexOf("https://")>-1||e)&&(c=new RegExp("(http|https)://"+c)),t=t.replace(c,h)),t}},orientationFix:function(t){return"LeftTopOrientation"===t||"LeftBottomOrientation"===t||"RightBottomOrientation"===t||"RightTopOrientation"===t?!0:!1}};s.checkHttpVersion(),i.exports={getThumbnail:function(t,e,i){var i=i||100,e=n.extend({width:115,height:115},e),o=location.protocol+"//pcsdata.baidu.com/rest/2.0/pcs/thumbnail?method=generate&app_id=250528",r={path:t,width:e.width,height:e.height,quality:i};for(var a in r){var s=encodeURIComponent(r[a]);o+="&"+a+"="+s}return this.getProcessedSrc(o)},getThumbnailByFile:function(t,e,i){var o,i=i||90,e=n.extend({width:115,height:115},e);if(t&&t.thumb)o=t.thumb.replace("&quality=100","&quality="+i).replace(/c\d+_u\d+/g,"c"+e.width+"_u"+e.height);else if(t&&t.thumbs){var r=t.thumbs.url3||t.thumbs.url2||t.thumbs.url1;o=r?r.replace("&quality=100","&quality="+i).replace(/c\d+_u\d+/g,"c"+e.width+"_u"+e.height):this.getThumbnail(t.path,e,i)}else t&&(o=this.getThumbnail(t.path,e,i));return this.getProcessedSrc(o)},getProcessedSrc:function(t){return s.getProcessedSrc(t)}}});
;define("file-widget-1:image/context.js",function(e,n,t){var o={context:null,version:null},i=e("file-widget-1:image/log.js");t.exports={getContext:function(){return o.context},setContext:function(e){o.context=e,e.log&&e.log.define&&e.log.define(i)},getVersion:function(){return o.version},setVersion:function(e){o.version=e}}});
;define("file-widget-1:image/util/picPreview/picPreview.js",function(i,e,t){var o=i("base:widget/libs/jquerypacket.js"),n=i("file-widget-1:image/context.js"),a=i("file-widget-1:image/util/picPreview/picPreview.tpl.js"),s=i("file-widget-1:image/util/showPic/showPic.tpl.js"),l=i("file-widget-1:image/util/picPreviewAside/picPreviewAside.tpl.js"),d=i("file-widget-1:image/util/thumbnailPic/thumbnailPic.tpl.js"),r=window.disk,c=window.yunData,g=function(){this._mCloseId=r.obtainId(),this._mCloudPrintBtn=r.obtainId(),this._mMagnifiId=r.obtainId(),this._mWinHeight=o(window).height(),this._mWinWdith=o(window).width()>g.MIN_WIDTH?o(window).width():g.MIN_WIDTH,this._mKeyguardListener=null,this._mMotionSensor=n.getContext().tools.motionSensor.hasMotionCampatibility(),this.$mod=null,this.$modBd=null,this.$modAside=null,this.$modCanvas=null,this.picAsideShow=!1,this.dialog=null,this.picPreviewAside=null,this._mResizeTimer=null,this._mScrollTimer=null,this._mMouseTimer=null,this._mKeyboardTimer=null,this.asideDisplayFlag=!1,this.thumbnailPicFlag=!1,this._mCoor=[],this.keepCanvas=!1,this._prebuild()};g.RESIZE_DELAY_TIME=200,g.SCROLL_DELAY_TIME=200,g.MOUSE_KEYBOARD_DELAY_TIME=200,g.MIN_WIDTH=1024,g.q={mod:"div.module-picPreview",modBd:'div[node-type="dlg-bd"]',modAside:"#picPreviewAside",modCanvas:"div.module-canvas",categoryItem:'div[node-type="category-item"]'},g.singleton=null,g.obtain=function(){return g.singleton?g.singleton:g.singleton=new g},g.buildDialog=function(i){var e=null,t=g.singleton;e=g.obtain(),e.initDialog(i),t||e._init(i),e.triggerEvent("resolve_pic_controls",i.controls||{}),e.triggerEvent("replcae_download_function",{downloadFunc:i.downloadFunc}),e.dialog.show(),e.dialog.$dialog[0].style.left=0,e.onVisibilityChange(),e.$modCanvas=o(this.q.modCanvas)},g.prototype.resizeCanvas=function(){this.$modCanvas.css({opacity:1,filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=1)",background:"#1f1f1f"})},g.getFileData=function(i,e){i.human_face&&i.tags&&i.tag&&i.dateTaken&&i.date_taken&&i.resolution&&i.size&&i.country&&i.province&&i.city&&i.district&&i.path||i.hasRequestFileMetas?e(i):o.ajax({url:"/aipic/image/filemetas",type:"GET",data:"fids="+o.stringify([i.fs_id]),dataType:"json",success:function(t){if(t&&0===t.errno&&t.list)for(var o=t.list[0],n=[{name:"human_face"},{name:"tags"},{name:"tag"},{name:"dateTaken"},{name:"date_taken"},{name:"resolution"},{name:"country",noValue:"other"},{name:"province",noValue:"other"},{name:"city",noValue:"other"},{name:"district",noValue:"other"},{name:"path"}],a=function(e,t,n,a){var s=t?!i[e]&&o&&o[e]&&"other"!==o[e]:!i[e]&&o&&o[e];s&&(a[e]=n[e])},s=0;s<n.length;s++){var l=n[s];a(l.name,l.noValue,o,i)}else r.DEBUG&&console.log("AJAX /aipic/image/filemetas ERROR !");e(i)},error:function(){r.DEBUG&&console.log("AJAX /aipic/image/filemetas ERROR !")}}),i.hasRequestFileMetas=!0},g.prototype.setSize=function(i,e){var t=this;t.dialog.$dialog.width(i),t.dialog.$dialog.height(e)},g.prototype.setLocation=function(i,e){var t=this;e=Math.max(0,e),t.dialog.$dialog[0].style.left=i+"px",t.dialog.$dialog[0].style.top=e+"px",t._mCoor[0]=i,t._mCoor[1]=e},g.prototype.initDialog=function(i){this.recordData(i),this.build()},g.prototype.recordData=function(i){this.conf=i},g.prototype._prebuild=function(){var i=this,e=n.getContext().tools.baseService.tmpl,t=o(window).width()>g.MIN_WIDTH?o(window).width():g.MIN_WIDTH;i.dialog=null===i.dialog?n.getContext().ui.window({title:"",titleIcon:"",theme:"",max:!1,back:!1,min:!1,close:!0,width:t,height:o(window).height(),draggable:!1,lock:!0,noHeader:!0,noFooter:!0}):i.dialog,i.dialog.$dialog.addClass("imgDialog");var r=document.createElement("div"),c=e(a);r.className="img-dialog module-picPreview",r.id="imgs-dialog",document.body.appendChild(r),r.innerHTML=c({closeId:this._mCloseId});var m=document.createElement("div"),h=e(s),u=e(d);m.className="dlg-bd",m.setAttribute("node-type","dlg-bd"),m.innerHTML=h({}),r.appendChild(m),r.innerHTML+=u({});var p=document.createElement("div"),_=e(l());p.className="dlg-aside",p.setAttribute("node-type","dlg-aside"),p.innerHTML=_({}),r.appendChild(p),i.dialog.$dialog.find(".dialog-body").html(r),i.$mod=i.dialog},g.prototype.build=function(){this._initDom(),this.requireModuleJs(),this.resolvBdSize(),this.triggerEvent("img_thumbnailPic",{index:this.conf.index,list:this.conf.list})},g.prototype.requireModuleJs=function(){window.showPic=i("file-widget-1:image/util/showPic/showPic.js"),g.picPreviewAside=i("file-widget-1:image/util/picPreviewAside/picPreviewAside.js"),i("file-widget-1:image/util/thumbnailPic/thumbnailPic.js")},g.prototype._initDom=function(){this.$mod=o(this.constructor.q.mod),this.$modBd=this.$mod.find(this.constructor.q.modBd),this.$modAside=this.$mod.find(this.constructor.q.modAside)},g.prototype.resolvBdSize=function(){var i=this.asideDisplayFlag,e=this.thumbnailPicFlag,t=Math.max(o(window).width(),g.MIN_WIDTH),n=o(window).height();this.$modBd.width(t-(i?278:0)),this.$modBd.height(n-(e?122:52)),this.triggerEvent("resize_picture",{imgDialogBd:this.$modBd})},g.prototype.dispatchDialogSize=function(){var i=this;if(i.dialog.isVisible()){var e=Math.max(o(window).width(),g.MIN_WIDTH),t=o(window).height();i.setSize(e,t),i.dispatchOnScroll()}},g.prototype.dispatchOnSize=function(){var i=this;i._mWinHeight=o(window).height(),i._mWinWidth=o(window).width()>g.MIN_WIDTH?o(window).width():g.MIN_WIDTH,i.dialog.isVisible()&&(i.setSize(i._mWinWidth,i._mWinHeight),i.resolvBdSize())},g.prototype.dispatchOnScroll=function(){var i=this;if(i.dialog.isVisible()){var e=Math.max(o("body").scrollLeft(),o("html").scrollLeft()),t=Math.max(o(window).scrollTop(),o("html").scrollTop());i.setLocation(e,t)}},g.prototype.dispatchOnMouseEvent=function(i){var e=this,t=i>0?1:-1;e.changeImgAnimation(t)},g.prototype.dispatchOnKeyboardEvent=function(i){var e=this;e.changeImgAnimation(i)},g.prototype._init=function(i){var e=this;i&&"unzip"==i.from&&(this.keepCanvas="keepCanvas"),o(window).bind("resize",function(){e.dialog.isVisible()&&(null!=e._mResizeTimer&&clearTimeout(e._mResizeTimer),e._mResizeTimer=setTimeout(function(){e._mResizeTimer=null,e.dispatchOnSize(),e.dispatchDialogSize()},e.constructor.RESIZE_DELAY_TIME))}),o(window).bind("scroll",function(){e.dialog.isVisible()&&(null!=e._mScrollTimer&&clearTimeout(e._mScrollTimer),e._mScrollTimer=setTimeout(function(){e._mScrollTimer=null,e.dispatchOnScroll()},e.constructor.SCROLL_DELAY_TIME))}),o("#"+e._mCloseId).bind("click",function(){e.clearReader(e.keepCanvas)});var t=n.getContext().tools.keyGuard;e._mKeyguardListener||(e._mKeyguardListener={onMount:function(){},onConnectivity:function(){},onKeyAction:function(i){if(e.dialog&&e.dialog.isVisible()===!0)switch(i){case t.EVENT_PAGE_UP:e.delayChangeImg(-1);break;case t.EVENT_PAGE_DOWN:e.delayChangeImg(1);break;case t.EVENT_ARROW_UP:e.delayChangeImg(-1);break;case t.EVENT_ARROW_DOWN:e.delayChangeImg(1);break;case t.EVENT_ARROW_LEFT:e.delayChangeImg(-1);break;case t.EVENT_ARROW_RIGHT:e.delayChangeImg(1);break;case t.EVENT_ESCAPE:e.clearReader(e.keepCanvas)}return!0},onKeyEvent:function(){}}),n.getContext().tools.baseService.mouseWheel(e.$modBd.get(0),function(i){null!=e._mMouseTimer&&clearTimeout(e._mMouseTimer),e._mMouseTimer=setTimeout(function(){e._mMouseTimer=null,e.dispatchOnMouseEvent(i)},e.constructor.MOUSE_KEYBOARD_DELAY_TIME)},"bool"),e.listenEvent()},g.prototype.listenEvent=function(){var i=this;n.getContext().message.listen("picPreviewAside_toggle",function(e){i.asideDisplayFlag=e,i.picAsideShow=e,i.resolvBdSize()}),n.getContext().message.listen("close_picPreview_dialog",function(){i.clearReader(i.keepCanvas)}),n.getContext().message.listen("thumbnailPic_toggle",function(e){i.thumbnailPicFlag=e,i.resolvBdSize()}),n.getContext().message.listen("changeToolbar",function(e){var t=i.conf.list[e],o=t.oper_id===c.MYUK,a=i.dialog.$dialog,s=a.find('[node-type="img-control"]'),l=a.find('[node-type="face-search"]'),d=a.find('[node-type="print-pic"]'),r=a.find('[node-type="control-share"]'),g=a.find('[node-type="control-edit"]'),m=a.find('[node-type="control-delete"]'),h=n.getContext().router.currentRouteName;"sharedir"===h?(s.addClass("img-control-noleft"),l.hide(),d.hide(),r.hide(),g.hide(),m.toggle(o)):(s.removeClass("img-control-noleft"),l.show(),d.show(),r.show(),g.show(),m.show())})},g.prototype.delayChangeImg=function(i){var e=this;null!=e._mKeyboardTimer&&clearTimeout(e._mKeyboardTimer),e._mKeyboardTimer=setTimeout(function(){e._mKeyboardTimer=null,e.dispatchOnKeyboardEvent(i)},e.constructor.MOUSE_KEYBOARD_DELAY_TIME)},g.prototype.changeImgAnimation=function(i){this.triggerEvent("change_picture",i)},g.prototype.setUsingMotionSensor=function(i){if(i){var e=n.getContext().tools.motionSensor,t=new e(o('div[node-type="img-nav"]')[0],e.HORIZONTAL),a=this;t.onMotion=function(i,e,t){a._mMotionAccept||(a.changeImgAnimation(t>0?-1:1),a._mMotionAccept=!0)},t.onMotionStart=function(){a._mMotionAccept=!1},t.onMotionEnd=function(){a._mMotionAccept=!1},t.install()}},g.prototype.triggerEvent=function(i,e){n.getContext().message.trigger(i,e)},g.prototype.clearReader=function(i){var e=this;"keepCanvas"===i?e.dialog.hide("keepCanvas"):e.dialog.hide(),this.triggerEvent("close_picPreview_success")},g.prototype.onVisibilityChange=function(){var i=this,e=n.getContext().tools.keyGuard,t=new e;this._mMotionSensor?this.setUsingMotionSensor(!0):i.dialog.isVisible()?t.acquire(this._mKeyguardListener,!0):this._mKeyguardListener&&t.release(this._mKeyguardListener)},g.prototype.constructor=g,g.prototype.showPicture=function(i){i.list[i.index];g.buildDialog(i)},t.exports={showPicture:function(i){var e=i.list[i.index];g.buildDialog(i),g.picPreviewAside.init(i),n.getContext().message.trigger("img_showAside",{file:e,hideMeta:i.hideMeta||!1}),n.getContext().message.trigger("changeToolbar",i.index)},getFileData:function(i,e){return g.getFileData(i,e)}}});
;define("file-widget-1:image/util/picCategory/picCategoryMap.js",function(e,o,p){var t={};t.toNum={people:256,people_one:257,people_two:258,people_three:259,people_more:260,animal:512,plant:768,landscape:1024,building:1280,building_indoor:1281,building_outdoor:1282,transport:1536,food:1792,screenshot:2304,other:2048},t.toStr={256:"people",257:" people_one",258:"people_two",259:"people_three",260:"people_more",512:"animal",768:"plant",1024:"landscape",1280:"building",1281:"building_indoor",1282:"building_outdoor",1536:"transport",1792:"food",2048:"other"},t.toCN={257:"单人",258:"双人",259:"三人",260:"多人",768:"植物",1024:"自然风景",1281:"室内建筑",1282:"室外建筑",1536:"交通工具",512:"动物",1792:"食物",2048:"其他"},p.exports=t});
;define("file-widget-1:image/util/picCategory-dialog/picCategory-dialog.js",function(t,e,a){function i(t){this.dialog=null,this.files=t,this.init()}var s=t("base:widget/libs/jquerypacket.js"),l=t("file-widget-1:image/context.js").getContext,o=t("file-widget-1:image/util/picCategory/picCategoryMap.js"),c=['<div class="content">',"<ul class='category_list global-clearfix'>",'<li data-key="people_one"><a href="javascript:;" class=\'cluster selected\'>单人</a>',"</li>",'<li data-key="people_two"><a href="javascript:;" class=\'cluster\'>双人</a>',"</li>",'<li data-key="people_three"><a href="javascript:;" class=\'cluster\'>三人</a>',"</li>",'<li data-key="people_more" class="content_right"><a href="javascript:;" class=\'cluster\'>多人</a>',"</li>","<li data-key=\"food\" class='content_bottom'><a href=\"javascript:;\" class='cluster'>食物</a>","</li>","<li data-key=\"landscape\" class='content_bottom'><a href=\"javascript:;\" class='cluster text_long'>自然风景</a>","</li>",'<li data-key="building_indoor" class="content_bottom">','<a href="javascript:;" class="cluster text_long">室内建筑</a>',"</li>",'<li data-key="building_outdoor" class="content_right content_bottom">',"<a href=\"javascript:;\" class='cluster text_long'>室外建筑</a>","</li>","<li data-key=\"plant\" class='content_bottom'><a href=\"javascript:;\" class='cluster'>植物</a>","</li>","<li data-key=\"animal\" class='content_bottom'><a href=\"javascript:;\" class='cluster'>动物</a>","</li>","<li data-key=\"transport\" class='content_bottom'><a href=\"javascript:;\" class='cluster text_long'>交通工具</a>","</li>","<li data-key=\"other\" class='content_bottom content_right'><a href=\"javascript:;\" class='cluster'>其他</a>","</li>","</ul>","</div>"].join("");i.prototype.init=function(){this.createDialog(),this.build()},i.prototype.createDialog=function(){this.dialog=l().ui.confirm("修改分类",c),this.dialog.$dialog.addClass("module-pic-category"),this.dialog.$dialog.width("480px"),this.dialog.show()},i.prototype.sendFiles=function(t,e){this.files=t,this.key=e,s(".cluster").removeClass("selected"),s(".module-pic-category").find("li[data-key="+o.toStr[e]+"]").children().addClass("selected")},i.prototype.request=function(t,e){var a=function(t){var e="";e=3===t?"一次操作文件不可超过200个":l().errorMsg(t),l().ui.tip({mode:"caution",msg:e||"网络错误，请稍候重试",hasClose:!1,autoClose:!0})};s.ajax({type:"GET",data:t,url:"/api/image/adjusttag",dataType:"json",success:function(t){0===t.errno?"function"==typeof e&&e(t):a(t.errno)},error:a})},i.prototype.build=function(){var t=this;s(window).bind("resize",function(){t.dialog.position("center",s("body"))}),s(".cluster").bind("click",function(t){var e=s(t.target);s(".cluster").removeClass("selected"),e.addClass("selected")}),s(".module-pic-category .dialog-close").click(function(){t.dialog.hide()});var e=s(".module-pic-category .dialog-footer .g-button");e[0].className+=" confirm",e[1].className+=" cancel",s(".confirm").click(function(e){e.stopPropagation();var a=t.files,i=a.length-1,c=[];do c.push(a[i].fs_id.toString());while(i-->0);var r=s(".selected"),n=r.parent().attr("data-key"),d=r.text();return o.toStr[t.key]!==n&&t.request({fid:s.stringify(c),tag:s.stringify([o.toNum[n].toString()])},function(){l().ui.tip({mode:"success",msg:"修改分类成功",hasClose:!1,autoClose:!0});for(var t=0;t<a.length;t++)a[t].tag=[o.toNum[n]];var e=l().message;e.callSystem("image-classify",!0),e.trigger("pic_category_sendCat",[d,o.toNum[n]]),e.trigger("user_seleced_all",!1)}),t.dialog.hide(),l().log.send({type:"timeline2_update_tag"}),!1}),s(".cancel").click(function(){return t.dialog.hide(),!1})},a.exports=i});
;define("file-widget-1:image/util/thumbnailPic/thumbnailPic.js",function(e){var t=e("base:widget/libs/jquerypacket.js"),i=e("file-widget-1:image/util/picPreview/picPreview.js"),n=e("file-widget-1:image/util/thumbnailPic/thumbnailPicList.tpl.js"),o=e("file-widget-1:image/context.js"),s=e("file-widget-1:image/util/picPreviewService/picPreviewService.js"),l=e("base:widget/libs/underscore.js"),r=e("base:widget/storage/storage.js"),d=function(){var e={},d={},a=function(){d.addEvent();var e=o.getContext().tools.baseService.client();6===e.browser.ie&&(d.$q.$showThumb.html('<em class="show-icon" node-type="show-icon"></em><span node-type="show-title">展开缩略图</span>'),d.$q.$printPic.html('<em class="print-icon"></em>云冲印'),d.q.showIcon='em[node-type="show-icon"]',d.$q.$showIcon=t(d.q.showIcon)),r.getItem("picDetailTip")&&d.$q.$detailTip.remove()};d.delayTime=200,d.delay=!1,d.firstResize=!0,d.deleteProcess=!1,d.thumbNum=11,d.flag=Math.floor((d.thumbNum-1)/2),d.filesList=[],d.index=0,d.arrow=0,d.start=0,d.end=0,d.thumbSize={width:256,height:256},d.defaultSize={width:window.screen.width,height:window.screen.height},d.thumbDefaultPicUrl="/yun-static/common/images/default_128.gif",d.apiVersion=o.getVersion(),d.q={mod:"div.module-thumbnailPic",thumbList:'ol[node-type="thumb-list"]',thumbItem:'li[node-type="thumb-item"]',sliderItem:'img[node-type="slider-item"]',operateArea:'div[node-type="operate-area"]',wrap:'div[node-type="thumb-wrap"]',showThumb:'div[node-type="show-thumb"]',showIcon:'em[node-type="show-icon"]',showTitle:'span[node-type="show-title"]',print_pic:"div[node-type='print-pic']",controlLeft:'em[node-type="control-left"]',controlRight:'em[node-type="control-right"]',controlShare:'em[node-type="control-share"]',controlDownload:'em[node-type="control-download"]',controlEdit:'em[node-type="control-edit"]',controlDelete:'em[node-type="control-delete"]',showThumbTitle:'em[node-type="show-thumb-title"]',showThumbIcon:'em[node-type="show-thumb-icon"]',detailTip:'div[node-type="img-detail-tip"]'},d.$q={$mod:t(d.q.mod),$thumbList:t(d.q.mod).find(d.q.thumbList),$sliderItem:t(d.q.mod).find(d.q.sliderItem),$thumbWrap:t(d.q.wrap),$showThumb:t(d.q.showThumb),$showIcon:t(d.q.showIcon),$showTitle:t(d.q.showTitle),$printPic:t(d.q.print_pic),$showThumbTitle:t(d.q.showThumbTitle),$showThumbIcon:t(d.q.showThumbIcon),$detailTip:t(d.q.detailTip)},d.resolvModSize=function(){d.$q.$thumbWrap.width(d.filesList.length>=d.thumbNum?94*d.thumbNum-4:94*d.filesList.length-4)},d.build=function(e){d.index=parseInt(e.index,10);for(var t=0;t<e.list.length;t++){var i=e.list[t];i.index=t,i.thumbUrl=s.getThumbnailByFile(i,d.thumbSize)}d.filesList=e.list,d.resolvModSize(),d.buildHtml()},d.buildHtml=function(){var e=o.getContext().tools.baseService.tmpl,i=e(n),s=(t(d.q.mod).find(d.q.sliderItem),d.index),l=d.thumbNum,r=d.flag,a=null;d.showPicture(),a=i(d.filesList.length>=d.thumbNum?s>=0&&r>=s?{list:d.filesList.slice(0,l),index:s}:d.filesList.length-r-1<=s&&s<=d.filesList.length-1?{list:d.filesList.slice(d.filesList.length-l),index:s}:{list:d.filesList.slice(s-r,s-r+l),index:s}:{list:d.filesList.slice(0,d.filesList.length),index:s}),d.$q.$thumbList.html(a),d.preLoadImg(),d.changeAside(),d.addSign(),d.arrow=s,o.getContext().message.trigger("changeToolbar",d.index)},d.deletePic=function(e){d.deleteProcess=!0,e.index==e.list.length&&(e.index-=1),d.build({index:e.index,list:e.list})},d.changePic=function(e){var t=d.arrow,i=d.flag,s=o.getContext().tools.baseService.tmpl,l=s(n),r=function(e){d.showPicture(),d.preLoadImg(),d.changeAside(),d.addSign(),d.arrow=e,o.getContext().message.trigger("changeToolbar",d.index)};if(e>0)if(t+=1,d.filesList.length>=d.thumbNum)if(t>=i+1&&t<=d.filesList.length-i-1)d.index=d.index+1,d.$q.$thumbList.get(0).removeChild(d.$q.$thumbList.children().get(0)),d.$q.$thumbList.append(l({list:d.filesList.slice(t+d.thumbNum-1-i,t+d.thumbNum-i),index:d.index})),r(t);else{if(!(t>=1&&i>=t||d.filesList.length-i-1<=t&&t<=d.filesList.length-1))return d.arrow=d.filesList.length-1,void d.loadNextDay();d.index=d.index+1,r(t)}else{if(!(t>=1&&t<=d.filesList.length-1))return d.arrow=d.filesList.length-1,void d.loadNextDay();d.index=d.index+1,r(t)}else if(t-=1,d.filesList.length>=d.thumbNum)if(t>=i&&t<=d.filesList.length-i-2)d.index=d.index-1,d.$q.$thumbList.get(0).removeChild(d.$q.$thumbList.children().get(d.thumbNum-1)),d.$q.$thumbList.prepend(l({list:d.filesList.slice(t-i,t-i+1),index:d.index})),r(t);else{if(!(t>=0&&i>t||d.filesList.length-i-2<t&&t<=d.filesList.length-2))return d.arrow=0,void d.loadPreDay();d.index=d.index-1,r(t)}else{if(!(t>=0&&t<=d.filesList.length-2))return d.arrow=0,void d.loadPreDay();d.index=d.index-1,r(t)}},d.loadNextDay=function(){o.getContext().ui.tip({mode:"caution",msg:"已经是最后一张图片啦",hasClose:!1,autoClose:!0})},d.loadPreDay=function(){o.getContext().ui.tip({mode:"caution",msg:"已经是第一张图片啦",hasClose:!1,autoClose:!0})},d.resetThumbList=function(){d.$q.$thumbList.html("")},d.changeAside=function(){var e=d.filesList[d.index],t=o.getContext().pageInfo.currentPage;t=/^share-/.test(t)?!0:!1,t?d.triggerEvent("img_showAside",{file:e,hideMeta:t}):i.getFileData(e,function(e){d.triggerEvent("img_showAside",{file:e,hideMeta:t})})},d.replaceErrorThumb=function(e){for(var i=t(d.q.mod).find(d.q.thumbItem),n=i.children(),o=n.length,s=0,l=null;o>s;s++)if(l=n.eq(s),l.data("index")==e){l.css("backgroundImage","url("+d.filesList[e].thumbUrl+")");break}},d.preLoadImg=function(){for(var e=function(e,t){t&&(e.width=this.width,e.height=this.height)},t=d.index,i=-1;5>i;i++){var n=t+i;if(0!=i&&n>=0&&n<d.filesList.length)d.loadImg(d.filesList[n],d.defaultSize,e);else if(0!=i&&0!=t)break}},d.loadImg=function(e,t,i){var n=(new Date).getTime()+"_preloadImg";window[n]=new Image;var l=window[n];l.src=s.getThumbnailByFile(e,t),l.startTime=+new Date,l.picType="thumbnail",t.width>256&&t.height>256&&(l.picType="bigPic");var r=function(e){var t=50;return"number"==typeof e?Math.ceil(e/t)*t:""};return l.complete?(window[n]=null,void i.call(l,e,!0)):(l.onload=function(){i.call(l,e,!0);var t=+new Date-l.startTime;o.getContext().log.send({type:"imgLoading_"+l.picType+"_"+r(t)}),l.onload=null,window[n]=null},void(l.onerror=function(){i.call(l,e,!1);var t=+new Date-l.startTime;o.getContext().log.send({type:"imgLoading_"+l.picType+"_"+r(t)}),l.onload=null,window[n]=null}))},d.addSign=function(){var e=t(d.q.mod).find(d.q.thumbItem),i=e.children(),n=i.length,o=0,s=null;for(e.removeClass("current");n>o;o++)if(s=i.eq(o),s.data("index")==d.index){s.parent().addClass("current");break}},d.showPicture=function(){d.triggerEvent("img_showPic",{index:d.index,file:d.filesList[d.index],len:d.filesList.length})},d.addEvent=function(){var e=d.$q.$mod,i=o.getContext().tools.baseService.client();d.$q.$mod.delegate(d.q.sliderItem,"click",function(){t(this).parent().hasClass("current")||(d.index=t(this).data("index"),t(d.q.mod).find(d.q.thumbItem).removeClass("current"),d.resetThumbList(),d.buildHtml())}),e.find(d.q.operateArea).bind("click",l.throttle(function(e){"undefined"==typeof t(e.target).attr("node-type")?o.getContext().message.trigger("operate_button",t(e.target).parent().attr("node-type")):o.getContext().message.trigger("operate_button",t(e.target).attr("node-type"))},1e3)),d.$q.$showThumb.bind("click",function(){d.$q.$thumbWrap.is(":animated")||d.$q.$thumbWrap.slideToggle(function(){if(6===i.browser.ie)d.$q.$showIcon.toggleClass("show"),d.$q.$showTitle.html(d.$q.$showIcon.hasClass("show")?"收起缩略图":"展开缩略图");else{{t("div.module-showPic").css("height")}"none"===d.$q.$thumbWrap.css("display")?(d.$q.$showThumbTitle.html("展开缩略图"),d.$q.$showThumbIcon.removeClass("icon-picpre-pulldown"),d.$q.$showThumbIcon.addClass("icon-picpre-pullup"),o.getContext().message.trigger("thumbnailPic_up_down",!1)):(d.$q.$showThumbTitle.html("收起缩略图"),d.$q.$showThumbIcon.removeClass("icon-picpre-pullup"),d.$q.$showThumbIcon.addClass("icon-picpre-pulldown"),o.getContext().message.trigger("thumbnailPic_up_down",!0)),d.$q.$showThumb.toggleClass("show")}})}),d.initListenEvent()},d.triggerEvent=function(e,t){o.getContext().message.trigger(e,t)},d.listenEvent=function(e,t){o.getContext().message.listen(e,t)},d.initListenEvent=function(){d.listenEvent("resize_picture",function(e){return d.delay?!1:(d.triggerEvent("resize_showPic",e),d.triggerEvent("resize_showAside",e),d.firstResize?d.firstResize=!1:(d.delay=!0,setTimeout(function(){d.delay=!1},d.delayTime)),void 0)}),d.listenEvent("img_thumbnailPic",function(e){d.build(e)}),d.listenEvent("change_picture",function(e){d.changePic(e)}),d.listenEvent("delete_picture",function(e){d.deletePic(e)}),d.listenEvent("close_picPreview_success",function(){d.firstResize=!0,d.resetThumbList()}),d.listenEvent("resolve_pic_controls",function(e){d.resolveControls(e)})};var h="show",m="hide";d.resolveControls=function(e){var i=o.getContext().pageInfo.currentPage;i=/^share-/.test(i)?!0:!1,i&&(e=t.extend({print:"hide",share:"hide",edit:"hide",del:"hide"},e,{})),e=e||{},d.$q.$mod.find(d.q.print_pic)[e.print?m:h](),d.$q.$mod.find(d.q.controlShare)[e.share?m:h](),d.$q.$mod.find(d.q.controlDownload)[e.download?m:h](),d.$q.$mod.find(d.q.controlEdit)[e.edit?m:h](),d.$q.$mod.find(d.q.controlDelete)[e.del?m:h](),e.hideAside&&d.triggerEvent("resolve_aside_visible",null)},a.apply(e,arguments)};new d});
;define("file-widget-1:image/util/picPreviewAside/picPreviewAside.js",function(e,t,i){var n=e("base:widget/libs/jquerypacket.js"),s=e("file-widget-1:image/context.js"),o=s.getContext,a=e("base:widget/tools/service/tools.format.js"),r=e("file-widget-1:image/util/picPreviewService/picPreviewService.js"),c=(e("base:widget/storage/storage.js"),!1),l=!1,d=6,p=3,f={init:function(e){var t=this;t.elements={mod:"#picPreviewAside",rectract:'div[node-type="retract"]',box:'div[node-type="box"]',filename:'div[node-type="filename"]',datePre:'div[node-type="date-pre"]',dateAfter:'div[node-type="date-after"]',info:'div[node-type="file-info"]',twoDimension:'div[node-type="dlg-two-dimension"]',downloadText:'a[node-type="downloadText"]',directoryBox:'div[node-type="directory-box"]',sculptureTop:'div[node-type="sculpture-top"]',sculptureBox:'div[node-type="sculpture-box"]',categoryTop:'div[node-type="category-top"]',categoryBox:'div[node-type="category-box"]',directory:'a[node-type="directory"]',size:'div[node-type="size"]',capacity:'div[node-type="capacity"]',address:'a[node-type="address"]'},t.conf=e||{},t.mod=n(t.elements.mod),t.rectract=t.mod.find(t.elements.rectract),t.box=t.mod.find(t.elements.box),t.dialog=null,t.close=!1,t.resize(),l||t.setData(),t.apiVersion=s.getVersion(),c||t.bindEvent()},bindEvent:function(){var t=this,i=t.box,s=t.rectract,a=t.mod.find(".sculpture-area");c=!0;var r=function(e){"none"===e?s.addClass("retract-icon-hide"):s.removeClass("retract-icon-hide")},l=function(e,n){n||(n={}),"block"===e?(t.mod.animate({left:278},10,function(){o().message.trigger("picPreviewAside_toggle",!1)}),i.animate({opacity:"hide"},10,function(){r("none")})):(t.mod.animate({left:0},10,function(){o().message.trigger("picPreviewAside_toggle",!0)}),i.animate({opacity:"show"},10,function(){r("block")}))};s.click(function(){l(i.css("display")),o().log.send({type:"picpreview_close_detail_click"})}),o().message.listen("resize_showAside",function(){t.resize()}),o().message.listen("resolve_aside_visible",function(){"none"===i.css("display")?(i.css("display","block"),l("none"),o().log.send({type:"picpreview_open_detail_click"})):(i.css("display","none"),l("block"),o().log.send({type:"picpreview_close_detail_click"}))}),o().message.listen("clean_detail_humanCover",function(e){for(var t=0;t<a.length;t++){var i=n(a[t]).find(".sculpture-img");n(i).css("display",status),e.isClean?n(i).css("display","none").attr("src",""):n(i).css("display","inline-block")}}),t.mod.find("a[node-type='editor-icon']").on("click",function(){var i=e("file-widget-1:image/util/picCategory-dialog/picCategory-dialog.js"),n=t.mod.find('span[node-type="type-name"]').attr("data-key"),s=t.mod.find('span[node-type="type-name"]').attr("data-index"),a=[];t.dialog=new i,o().message.listen("pic_category_sendCat",function(e){t.mod.find('span[node-type="type-name"]').html(e[0]).attr("data-key",e[1]);var i=t.conf.list,n=t.conf.index,s=t.conf.list[n],a=i.length;o().message.trigger("delete_picPreview",{callback:function(e){return 1==a?(o().message.trigger("close_picPreview_dialog"),!0):void o().message.trigger("delete_picture",{list:e,index:n})},index:n,file:s})});for(var r in t.conf.list)s==t.conf.list[r].fs_id&&(a.push(t.conf.list[r]),t.dialog.sendFiles(a,n),a=[])}),o().message.callPlugin("网盘链接管理-二维码@com.baidu.pan",{target:n(t.elements.downloadText),imgSrc:"/box-static/file-widget-1/image/util/img/_nomd5/baidu_app_link.png?t=1522054615923",imgTit:"",flagAddIframe:!0,topOffset:-1,leftOffset:11,hoverCallBack:function(){n(t.elements.downloadText).addClass("hover")},leaveCallBack:function(){n(t.elements.downloadText).removeClass("hover")}}),n(t.elements.directory).on("click",function(){o().log.send({type:"picpreview_open_directory_click"})}),n(t.elements.categoryLeftInfo).on("click",function(){o().log.send({type:"picpreview_open_category_click"})}),n(t.elements.categoryRightInfo).on("click",function(){o().log.send({type:"picpreview_open_category_click"})})},setData:function(){var e=this,t=e.mod.find(e.elements.info),i=(t.find(e.elements.humanSculpture),t.find(e.elements.sculptureTop)),s=t.find(e.elements.sculptureBox),c=t.find(e.elements.categoryTop),f=t.find(e.elements.categoryBox),h=f.children(),u=t.find(e.elements.dateAfter),m=t.find(e.elements.datePre),g=t.find(e.elements.size),y=t.find(e.elements.capacity),v=t.find(e.elements.address),k=t.find(e.elements.filename),_=t.find(e.elements.directory),b=o().tools.shareDirManager;l=!0,o().message.listen("img_showAside",function(t){var l,x,w,C,P,A,T,z=t.file,j=function(e){for(var t=[[],[]],i=0;i<e.length;i++)t[0].push("/disk/timeline#/faceList/"+e[i].person_id),t[1].push(e[i].cover_photo);return t},O=function(e){var t=new Date(1e3*e),i=["周日","周一","周二","周三","周四","周五","周六","周日"],n=[t.getFullYear(),t.getMonth()+1,t.getDate(),i[t.getDay()],t.getHours(),t.getMinutes()],s="",o=[],a=function(e){return e>=0&&9>=e&&(e="0"+e),e};return s=n[4]<12?"上午":"下午",n[4]=a(n[4]),n[5]=a(n[5]),o.push(n[0]+"年"+n[1]+"月"+n[2]+"日"),o.push(n[3]+"，"+s+n[4]+":"+n[5]),o},I=function(e){for(var t=e.split(","),i=[],n=0;n<t.length;n++)i.push(t[n].match(/\d+/g));return i.join(" x ")},B=function(e){var t,i,n,s=e.split("/");return""===s[s.length-2]?(t=s.pop(),i="我的网盘",n="/disk/home"):(t=s.pop(),i=s.pop(),n="/disk/home#/all?path="+encodeURIComponent(e.substr(0,e.lastIndexOf("/")+1))),{filename:t,dirname:i,href:n}},D=function(e){var t,i,n,s=b.getFakepathInfo(e);if(s&&s.subPath){var o=s.subPath.split("/");o.length>1?(t=o.pop(),i=o.pop(),n="/disk/home#/sharedir?path="+encodeURIComponent("/"+s.fakeRootPath+"/"+s.subPath.substr(0,s.subPath.lastIndexOf("/")))):(t=o.pop(),b.getNameByFakepath(e,function(e){i=e}),n="/disk/home#/sharedir?path="+encodeURIComponent("/"+s.fakeRootPath))}return{filename:t,dirname:i,href:n}},R=function(e){for(var t={affair:[],position:[]},i=0;i<e.length;i++){var n=e[i].tag_type;1===n?t.affair.push(e[i].tag_id):2===n&&t.position.push(e[i].tag_id)}return t},S=function(t){if("[object Array]"===Object.prototype.toString.call(t)){var i,n=[257,258,259,260,512,768,1024,1281,1282,1536,1792,2304,2048],s=[1,2,17,18,19,20,21,22,23,100,200,300,440,501,502,503,504,505,506,507,508,509,510,511,512,513,515,700,801,901,902,903,1e3,1001,1002,2e3];i=e.apiVersion?s:n;var o=function(e,t){for(var i=[],n=0;n<t.length;n++)-1!==e.indexOf(t[n])&&i.push(t[n]);return i},a=function(t){if(e.apiVersion){for(var i,n,s=[17,18,801],o=[1,2,19,20,21,22,23,100,200,300,440,501,502,503,505,506,508,509,510,511,512,513,515,700,902,903,1e3,1001,1002,2e3],a=[901],r=[504,507],c=[[],[],[],[]],l=[[],[],[],[]],d=[],p=0;p<t.length;p++)-1!==s.indexOf(t[p])?(c[0].push(t[p]),l[0].push(46)):-1!==o.indexOf(t[p])?(c[1].push(t[p]),l[1].push(46)):-1!==a.indexOf(t[p])?(c[2].push(t[p]),l[2].push(66)):-1!==r.indexOf(t[p])&&(c[3].push(t[p]),l[3].push(76));return i=c[1].concat(c[0]).concat(c[2]).concat(c[3]),n=l[1].concat(l[0]).concat(l[2]).concat(l[3]),i&&0!==i.length&&d.push(i),n&&0!==n.length&&d.push(n),d}var f=t.indexOf(1536),h=[];return 2===t.length?-1!==f?(h.push(t.splice(f,1).push(1536)),h.push([46,66]),h):(h.push(t),h.push([46,46]),h):1===t.length?-1!==f?(h.push(t),h.push([66]),h):(h.push(t),h.push([46]),h):h},r=o(i,t);return a(r)}return[]},F=function(t){var i,n={257:"单人",258:"双人",259:"三人",260:"多人",512:"动物",768:"植物",1792:"食物",1024:"风景",1281:"室内",1282:"室外",1536:"交通工具",2304:"截屏",2048:"其他"},s={1:"街景",2:"装修",17:"车",18:"船",19:"婚礼",20:"演出",21:"聚会",22:"截图",23:"卡通",100:"食物",200:"动物",300:"运动",440:"家居",501:"海洋",502:"水下",503:"沙滩",504:"河流与湖泊",505:"雪地",506:"天空",507:"日出与日落",508:"草原",509:"山峰",510:"星空",511:"夜景",512:"沙漠",513:"山谷",515:"瀑布",700:"票据",801:"花",901:"建筑外景",902:"教堂",903:"寺庙",1e3:"人物",1001:"宝宝",1002:"自拍",2e3:"其他"};i=e.apiVersion?s:n;for(var o=[],a=[],r=[],c=0;c<t.length;c++)t[c]in i&&(o.push(i[t[c]]),a.push("/disk/timeline#/classifyList/1/"+t[c]));return r.push(o),r.push(a),r};if(e.apiVersion?z.tags&&(l=R(z.tags),x=l.affair,w=l.position,w&&(C="/disk/timeline#/classifyList/2/"+w),P=S(x)):z.tag&&(P=S(z.tag)),P&&2===P.length&&(A=F(P[0])),A&&2===A.length&&(T=P[1]),z.date_taken&&(z.dateTaken=z.date_taken),z.dateTaken)var V=O(z.dateTaken);var L=z.resolution?I(z.resolution):"",M=z.size?a.toFriendlyFileSize(z.size):"";if(z.path)var U="sharedir"===o().router.currentRouteName?D(z.path):B(z.path);if(z instanceof Object&&(g.show(),y.show(),z.resolution&&z.size?(g.html(L),y.html(M)):z.resolution&&!z.size?(g.html(L),y.hide()):!z.resolution&&z.size?(y.html(M),g.hide()):(g.html("未知"),y.hide()),z.path?k.html(U.filename).attr("title",U.filename):k.html("未知"),!t.hideMeta)){if(z.human_face&&z.human_face.length>0){o().message.trigger("clean_detail_humanCover",{isClean:!1});var E=j(z.human_face),N=s.children(),q=[],H=[];"none"===i.css("display")&&i.css("display","block"),"none"===s.css("display")&&s.css("display","block");for(var Y=0;Y<N.length;Y++)q.push(n(N[Y]).children()[0]);for(var G=0;G<q.length;G++)H.push(n(q[G]).children()[0]);for(var J=0;J<E[0].length;J++)n(q[J]).attr("href",E[0][J]),n(H[J]).attr("src",r.getProcessedSrc(E[1][J])),n(N[J]).css("display","inline-block");for(;d>J;)n(N[J]).css("display","none"),J++}else i.css("display","none"),s.css("display","none");if(A&&0!==A.length&&T&&0!==T.length){var K=[];"none"===c.css("display")&&c.css("display","block"),"none"===f.css("display")&&f.css("display","block");for(var Q=0;Q<h.length;Q++)K.push(n(h[Q]).children()[0]);for(var W=0;W<A[0].length;W++)n(h[W]).css("display","inline-block").css("width",T[W]),n(K[W]).html(A[0][W]).attr("href",A[1][W]);for(;p>W;)n(h[W]).css("display","none"),W++}else c.css("display","none"),f.css("display","none");if(z.dateTaken?("none"===u.css("display")&&u.css("display","block"),m.html(V[0]),u.html(V[1])):(m.html("神秘时间"),u.css("display","none")),z.country&&"other"!==z.country&&z.province&&"other"!==z.province&&z.city&&"other"!==z.city){var X="";z.province===z.city?(X=z.district&&"other"!==z.district?z.country+" "+z.province+" "+z.district:z.country+" "+z.province,v.html(X).attr("title",X)):(X=z.country+" "+z.province+" "+z.city,v.html(X).attr("title",X)),C?v.attr("href",C).css("text-decoration","underline"):v.removeAttr("href").css("text-decoration","none")}else v.html("未知").removeAttr("href").css("text-decoration","none");z.path?(_.html(U.dirname).attr("title",U.dirname),_.attr("href",U.href)):_.html("未知").removeAttr("href")}})},resize:function(){var e=this;n(document).width()<1024&&(e.close?(e.mod.css("left","0px"),e.rectract.removeClass("retract-icon-hide"),e.box.css("display","block"),e.close=!1):(e.mod.css("left","253px"),e.rectract.addClass("retract-icon-hide"),e.box.css("display","none")))}};i.exports=f});
;define("file-widget-1:image/util/showPic/showPic.js",function(e){var i=e("base:widget/libs/jquerypacket.js"),t=e("file-widget-1:image/context.js"),o=e("file-widget-1:image/util/picPreviewService/picPreviewService.js"),n=e("base:widget/storage/storage.js"),a=function(){var e={},a={},r=t.getContext().ui.loading({container:i(".img-loading"),text:!1,size:26}),l=function(){a.addEvent(),a.transformSupport=a.css3Support("transform")};a.q={mod:"div.module-showPic",imgWrap:'div[node-type="img-wrap"]',imgNav:'div[node-type="img-nav"]',viewpic:'img[node-type="viewpic-image"]',viewpicSub:'img[node-type="viewpic-image-substitute"]',imgNavLeft:'div[node-type="img-nav-left"]',preArrow:'span[node-type="pre-arrow"]',imgNavRight:'div[node-type="img-nav-right"]',nextArrow:'span[node-type="next-arrow"]',imgLoader:'div[node-type="img-loader"]',operateArea:'div[node-type="operate-area"]',faceSearch:'div[node-type="face-search"]',thumbnailPic:"div.module-thumbnailPic",detailTip:'div[node-type="img-detail-tip"]'},a.$q={$mod:i(a.q.mod),$imgWrap:i(a.q.mod).find(a.q.imgWrap),$viewpic:i(a.q.mod).find(a.q.viewpic),$viewpicSub:i(a.q.mod).find(a.q.viewpicSub),$imgNavLeft:i(a.q.mod).find(a.q.imgNavLeft),$preArrow:i(a.q.mod).find(a.q.preArrow),$imgNavRight:i(a.q.mod).find(a.q.imgNavRight),$nextArrow:i(a.q.mod).find(a.q.nextArrow),$imgLoader:i(a.q.mod).find(a.q.imgLoader),$operateArea:i(a.q.mod).find(a.q.operateArea),$thumbnailPic:i(a.q.thumbnailPic),$detailTip:i(a.q.detailTip)},a.defaultSize={width:window.screen.width,height:window.screen.height},a.thumbSize={width:256,height:256},a.largeSize={width:1e4,height:1e4},a.defaultErrorSize={width:128,height:128},a.paddingWidth=120,a.paddingHeight=20,a.size={},a.viewpicsubSize={},a.timelineFlag=!1,a.file={},a.len=0,a.rotate=0,a.defaultErrorPicUrl="/yun-static/common/images/default_128.gif",a.defaultPicUrl="/yun-static/common/images/default.gif",a.css3Support=function(e){var i=document.createElement("div"),t="Khtml O Moz Webkit".split(" "),o=t.length;if(e in i.style)return!0;if("-ms-"+e in i.style)return!0;for(e=e.replace(/^[a-z]/,function(e){return e.toUpperCase()});o--;)if(t[o]+e in i.style)return!0;return!1},a.resolvModSize=function(e){a.$q.$mod.width(e.width()-a.paddingWidth),a.$q.$mod.height(e.height()-a.paddingHeight)},a.showPicture=function(e){a.recordData(e),a.controlNavButton(),a.showCurrentPic(e.file),yunData&&1==yunData.faceStatus&&a.checkFaceSreach()},a.controlNavButton=function(){1===+a.len?(a.$q.$imgNavRight.hide(),a.$q.$imgNavLeft.hide()):(a.$q.$imgNavLeft.css("display","inline"),a.$q.$imgNavRight.css("display","inline"))},a.recordData=function(e){if(a.index=e.index,a.file=e.file,a.len=e.len,e.file.resolution&&e.file.orientation){a.timelineFlag=!0;for(var i=e.file.resolution.split(","),t=[],o={},n=0;n<i.length;n++)t.push(i[n].match(/\d+/g));var r=t[0],l=t[1];if(("LeftTopOrientation"===e.file.orientation||"LeftBottomOrientation"===e.file.orientation||"RightBottomOrientation"===e.file.orientation||"RightTopOrientation"===e.file.orientation)&&r>l){var c=r;r=l,l=c}o.width=r,o.height=l,a.viewpicsubSize=a.calculateViewpicsubSize(o)}},a.imgArea=function(){a.size=a.resolvImgSize(a.file),a.size&&a.layoutImg(a.size)},a.sameProportion=function(e,i){if(!i.width||!i.height)return null;var t=i.width/i.height,o=i.width/e.width,n=i.height/e.height;return 1>=o&&1>=n?e={width:i.width,height:i.height}:o>=n?e={width:e.width,height:parseInt(e.width/t)}:n>=o&&(e={width:parseInt(e.height*t),height:e.height}),e},a.layoutImg=function(e){e&&(a.$q.$viewpic.css("top",parseInt((a.$q.$mod.height()-e.height)/2,10)),a.$q.$viewpic.css("left",parseInt((a.$q.$mod.width()-e.width)/2,10)),a.$q.$viewpic.css("width",e.width),a.$q.$viewpic.css("height",e.height))},a.layoutImgSub=function(e){e&&(a.$q.$viewpicSub.css("top",parseInt((a.$q.$mod.height()-e.height)/2,10)),a.$q.$viewpicSub.css("left",parseInt((a.$q.$mod.width()-e.width)/2,10)),a.$q.$viewpicSub.css("width",e.width),a.$q.$viewpicSub.css("height",e.height))},a.resolvImgSize=function(e){var i={width:a.$q.$mod.width(),height:a.$q.$mod.height()},t=a.sameProportion(i,{width:e.width,height:e.height});return t},a.calculateViewpicsubSize=function(e){var i={width:a.$q.$mod.width(),height:a.$q.$mod.height()},t=a.sameProportion(i,{width:e.width,height:e.height});return t},a.showCurrentPic=function(e){if(void 0!==e){var n=o.getThumbnailByFile(e,a.defaultSize),l=o.getThumbnailByFile(e,a.thumbSize),c=a.loadImg({url:l,flag:!0}),d=a.loadImg({url:n,flag:!0,callback:function(){a.file.width=this.width,a.file.height=this.height}}),s=function(e,t,o){o?(a.$q.$viewpic.css("visibility","hidden"),a.layoutImgSub(a.viewpicsubSize),i(a.q.mod).find(a.q.viewpicSub).attr("src",t),i(a.q.mod).find(a.q.viewpic).attr("src",e)):(a.$q.$viewpic.css("visibility","hidden"),a.layoutImgSub(a.viewpicsubSize),i(a.q.mod).find(a.q.viewpicSub).attr("src",t),a.$q.$viewpicSub.css("visibility","visible"))};if(d)a.clearRotate(),a.imgArea(),s(n,l,!0);else if(c&&a.timelineFlag){a.loadStartTime=(new Date).getTime(),s(n,l,!1);var g=function(e,i){e.index===a.index&&(i===!0?(a.file.width=this.width,a.file.height=this.height,a.clearRotate(),a.imgArea(),a.$q.$viewpic.attr("src",e.url)):(a.file.width=a.defaultErrorSize.width,a.file.height=a.defaultErrorSize.height,a.clearRotate(),a.imgArea(),a.$q.$viewpic.attr("src",a.defaultErrorPicUrl)))};a.loadImg({callback:g,url:n,index:a.index})}else{a.loadStartTime=(new Date).getTime(),"hidden"!==a.$q.$viewpicSub.css("visibility")&&a.$q.$viewpicSub.css("visibility","hidden"),"hidden"!==a.$q.$viewpic.css("visibility")&&a.$q.$viewpic.css("visibility","hidden"),r.show();var g=function(e,i){e.index===a.index&&(1==i?(a.file.width=this.width,a.file.height=this.height,a.clearRotate(),a.imgArea(),s(e.url,e.urlSub,!0)):(a.file.width=a.defaultErrorSize.width,a.file.height=a.defaultErrorSize.height,a.clearRotate(),a.imgArea(),s(a.defaultErrorPicUrl,a.defaultErrorPicUrl,!0)))};a.loadImg({callback:g,url:n,urlSub:l,index:a.index})}a.picpreStatistic(),t.getContext().message.trigger("send_preview_log")}},a.loadImg=function(e){var i=(new Date).getTime()+"_preloadImg";window[i]=new Image;var o=window[i];return o.src=e.url,e.flag?o.complete||o.width>0&&o.height>0?(window[i]=null,"function"==typeof e.callback&&e.callback.call(o),!0):(window[i]=null,!1):o.complete?("function"==typeof e.callback&&e.callback.call(o,{url:e.url,urlSub:e.urlSub,index:e.index},!0),void(window[i]=null)):(o.onload=function(){a.loadTime=(new Date).getTime()-a.loadStartTime,"function"==typeof e.callback&&e.callback.call(o,{url:e.url,urlSub:e.urlSub,index:e.index},!0),t.getContext().log.send({name:"show_imgLoad",sendServerLog:!1,value:a.loadTime}),t.getContext().log.send({url:"//update.pan.baidu.com/statistics",op:"loadImage",type:"ignore",other0:"big",other1:"false",other2:1,other3:a.loadTime,other4:!1,other5:"webtimeline"}),o.onload=null,window[i]=null},void(o.onerror=function(){"function"==typeof e.callback&&e.callback.call(o,{url:e.url,urlSub:e.urlSub,index:e.index},!1),o.onload=null,window[i]=null}))},a.changePic=function(e){a.triggerEvent("change_picture",e)},a.sendPreviewLog=function(e,i){var o=t.getContext(),n="disk-home"===o.pageInfo.currentPage?1:0,r=0,l=0;if(n){var c=o.router.currentRouteName,d=o.router.query.get("type");l="category"===c&&"3"===d}else r=window.location.href.indexOf("/disk/timeline")>=0?1:0;o.log.send({type:"picpreview-successed-analyties",ctime:i.server_ctime||0,fsid:i.fs_id,md5:i.md5,flagdiskhome:n,flagnearupload:l,flagtimeline:r,timeCost:a.loadTime||0,flagAsideSelectedPic:yunData.asideSelectedPic||0,pageurl:encodeURIComponent(window.location.href),sendPageFrom:!0})},a.picpreStatistic=function(){var e="/disk/home"===window.location.pathname?1:0,i="/disk/timeline"===window.location.pathname?1:0;e?t.getContext().log.send({type:"picpreview_disk_home_click"}):i&&t.getContext().log.send({type:"picpreview_timeline_click"})},a.clearRotate=function(){a.$q.$viewpic.attr("class",""),a.$q.$viewpic.css("filter","progid:DXImageTransform.Microsoft.BasicImage(rotation=0)"),a.$q.$viewpic.css("msfilter","progid:DXImageTransform.Microsoft.BasicImage(rotation=0)"),a.$q.$viewpic.css({transform:"rotate(0deg)","-webkit-transform":"rotate(0deg)","-moz-transform":"rotate(0deg)","-o-transform":"rotate(0deg)","-ms-transform":"rotate(0deg)"}),a.rotate=0},a.deleteSuccess=function(e,i,o){if(1===e){var n=o.errno,r=i;102===n&&o.info&&o.info[0]&&o.info[0].errno&&(n=102===o.info[0].errno?"-102":o.info[0].errno,r=t.getContext().errorMsg(n,r)),t.getContext().ui.tip({mode:"caution",msg:r,hasClose:!0,autoClose:!0})}else a.triggerEvent("delete_picPreview",{callback:function(e){return 1===a.file.length?(a.triggerEvent("close_picPreview_dialog"),!0):void a.triggerEvent("delete_picture",{list:e,index:a.index})},index:a.index,file:a.file})},a.largePic=function(){var e=a.file,i=o.getThumbnailByFile(e,a.largeSize);window.open(i)},a.checkFaceSreach=function(){var e=i(a.q.faceSearch);"undefined"==typeof a.file.faceinfo?i.get("/api/image/faceinfo",{fid:a.file.fs_id},function(t){t=i.parseJSON(t),t&&0===t.errno?t.faceinfo&&t.faceinfo.length>0&&t.faceinfo[0].face&&t.faceinfo[0].face.length>0?(a.file.faceinfo=!0,e.css("display","block")):(a.file.faceinfo=!1,e.css("display","none")):e.css("display","none")}).error(function(){e.css("display","none")}):a.file.faceinfo?e.css("display","block"):e.css("display","none")},a.clickFaceSearch=function(){window.open("/disk/facesearch?fsid="+a.file.fs_id),t.getContext().log.send({type:"timeline_facesearch_search",pageurl:encodeURIComponent(window.location.href),picpreview:1})},a.printPic=function(){var e=a.file;t.getContext().message.callPlugin("网盘云冲印@com.baidu.pan",{filesList:[e],isview:1})},a.controlToolBar=function(e){e===!0?a.controlNavButton():(a.$q.$imgNavLeft.css("display","none"),a.$q.$imgNavRight.css("display","none"))},a.controlRotate=function(e){var i,t={width:a.$q.$viewpic.width(),height:a.$q.$viewpic.height()},o={width:a.$q.$imgWrap.width(),height:a.$q.$imgWrap.height()};if("#"!=a.$q.$viewpic.attr("src"))if(a.rotate+=e,t.width>o.height&&a.rotate%2?(i=a.sameProportion(o,{width:t.height,height:t.width}),i={width:i.height,height:i.width}):i=a.sameProportion(o,{width:a.file.width,height:a.file.height}),a.layoutImg(i),a.transformSupport)a.$q.$viewpic.addClass("rotate"),a.$q.$viewpic.css({transform:"rotate("+90*a.rotate+"deg)","-webkit-transform":"rotate("+90*a.rotate+"deg)","-moz-transform":"rotate("+90*a.rotate+"deg)","-o-transform":"rotate("+90*a.rotate+"deg)","-ms-transform":"rotate("+90*a.rotate+"deg)"});else{var n=parseInt(a.rotate)>0?parseInt(a.rotate)%4:parseInt(a.rotate)%4+4;a.$q.$viewpic.css("filter","progid:DXImageTransform.Microsoft.BasicImage(rotation="+n+")"),a.$q.$viewpic.css("msfilter","progid:DXImageTransform.Microsoft.BasicImage(rotation="+n+")"),n%2?a.$q.$viewpic.css({top:(a.$q.$imgWrap.height()-a.$q.$viewpic.height())/2-10,left:(a.$q.$imgWrap.width()-a.$q.$viewpic.width())/2}):a.layoutImg(i)}},a.controlShare=function(){var e=a.file;t.getContext().message.callPlugin("网盘分享@com.baidu.pan",{filesList:[e]})},a.downloadFunc=null,a.controlDownload=function(){var e=a.file;"function"==typeof a.downloadFunc?a.downloadFunc(a.file):t.getContext().message.callPlugin("网盘下载@com.baidu.pan",{filesList:[e]})},a.controlEdit=function(){var e=a.file;t.getContext().message.callPlugin("美图秀秀@com.meitu",{filesList:[e]})},a.controlDelete=function(){t.getContext().message.callPlugin("网盘文件删除@com.baidu.pan",{filesList:a.file,callback:a.deleteSuccess,sync:!0})},a.controlReappear=function(){t.getContext().message.trigger("resolve_aside_visible"),a.$q.$detailTip.hide(),n.getItem("picDetailTip")||n.setItem("picDetailTip",!0)},a.addEvent=function(){t.getContext().message.listen("operate_button",function(e){switch(e){case"large-pic":a.largePic();break;case"face-search":a.clickFaceSearch();break;case"print-pic":a.printPic();break;case"control-left":a.controlRotate(-1);break;case"control-share":a.controlShare();break;case"control-download":a.controlDownload();break;case"control-edit":a.controlEdit();break;case"control-delete":a.controlDelete();break;case"control-reappear":a.controlReappear()}var i=function(e){var i=e.split("-"),t=i.join("_");return t};t.getContext().log.send({type:"picpreview_"+i(e)+"_click"})}),a.preOrNextPic(),a.initListenEvent(),a.loadingCompensate()},a.preOrNextPic=function(){a.$q.$mod.delegate(a.q.imgNavLeft,"click",function(){a.changePic(-1)}),a.$q.$mod.delegate(a.q.imgNavRight,"click",function(){a.changePic(1)}),a.$q.$mod.bind("mouseenter",function(){a.controlToolBar(!0)}),a.$q.$mod.bind("mouseleave",function(){a.controlToolBar(!1)}),a.$q.$imgNavLeft.on("mouseenter",function(){a.$q.$preArrow.addClass("pre-arrow-hover")}),a.$q.$imgNavLeft.on("mouseleave",function(){a.$q.$preArrow.removeClass("pre-arrow-hover")}),a.$q.$imgNavRight.on("mouseenter",function(){a.$q.$nextArrow.addClass("next-arrow-hover")}),a.$q.$imgNavRight.on("mouseleave",function(){a.$q.$nextArrow.removeClass("next-arrow-hover")})},a.loadingCompensate=function(){a.$q.$viewpic.load(function(){"none"!==i(".img-loading").css("display")&&r.hide(),a.$q.$viewpicSub.css("visibility","hidden"),a.$q.$viewpicSub.attr("src","#"),a.$q.$viewpic.css("visibility","visible")}),a.$q.$viewpicSub.load(function(){"none"!==i(".img-loading").css("display")&&r.hide(),a.$q.$viewpicSub.css("visibility","visible")})},a.triggerEvent=function(e,i){t.getContext().message.trigger(e,i)},a.listenEvent=function(e,i){t.getContext().message.listen(e,i)};var c="show",d="hide";a.resolveControls=function(e){e=e||{},a.$q.$mod.find(a.q.printPic)[e.print?d:c](),a.$q.$mod.find(a.q.controlShare)[e.share?d:c](),a.$q.$mod.find(a.q.controlDownload)[e.download?d:c](),a.$q.$mod.find(a.q.controlEdit)[e.edit?d:c](),a.$q.$mod.find(a.q.controlDelete)[e.del?d:c](),e.hideAside&&a.triggerEvent("resolve_aside_visible",null)},a.replaceDownloadFunc=function(e){a.downloadFunc="function"==typeof e?e:null},a.initListenEvent=function(){a.listenEvent("resize_showPic",function(e){a.resolvModSize(e.imgDialogBd),a.imgArea()}),a.listenEvent("img_showPic",function(e){a.showPicture(e),a.triggerEvent("clean_detail_humanCover",{isClean:!0})}),a.listenEvent("close_picPreview_success",function(){a.$q.$viewpic.attr("src","#"),a.$q.$viewpic.css("width","100%"),a.$q.$viewpic.css("height","100%")}),a.listenEvent("resolve_pic_controls",function(e){a.resolveControls(e)}),a.listenEvent("replcae_download_function",function(e){a.replaceDownloadFunc(e.downloadFunc)}),a.listenEvent("send_preview_log",function(){a.sendPreviewLog(1,a.file)}),a.listenEvent("thumbnailPic_up_down",function(e){a.triggerEvent("thumbnailPic_toggle",e),a.resolvModSize(i('div[node-type="dlg-bd"]')),a.imgArea()})},l.apply(e,arguments)};new a});
;define("file-widget-1:image/util/thumbnailPic/thumbnailPic.tpl.js",function(e,t,o){var i=[];i.push('<div class="module-thumbnailPic">'),i.push('<div class="operate-area" node-type="operate-area">'),i.push('<div class="operate-container" node-type="operate-container">'),i.push('                  <div node-type="print-pic" class="print-pic icon icon-picpre-cloudprint">'),i.push('                      <em class="print-pic-title">云冲印</em>'),i.push("                  </div>"),i.push('                  <div class="img-control" node-type="img-control">'),i.push('                      <em node-type="large-pic" class="control control-left icon icon-picpre-enlarge" title="放大"></em>'),i.push('                      <em node-type="control-left" class="control control-left icon icon-picpre-rotate" title="左旋转"></em>'),i.push('                      <em node-type="control-share" class="control control-share icon icon-my-share" title="分享给好友"></em>'),i.push('                      <em node-type="control-download" class="control control-download icon icon-picpre-download" title="下载图片"></em>'),i.push('                      <em node-type="control-edit" class="control control-edit icon icon-picpre-beautify" title="美化图片"></em>'),i.push('                      <em node-type="control-delete" class="control control-delete icon icon-picpre-delete" title="删除图片"></em>'),i.push('                      <em node-type="control-reappear" class="control control-reappear icon icon-picpre-detail" title="图片详情">'),i.push('                          <div node-type="img-detail-tip" class="img-detail-tip">图片详情在这里哦～<div node-type="tip-triangle" class="tip-triangle"></div></div>'),i.push("                      </em>"),i.push("                  </div>"),i.push('                  <div node-type="show-thumb" class="show-thumb">'),i.push('                      <em class="show-thumb-title" node-type="show-thumb-title">展开缩略图</em>'),i.push('                      <em class="icon icon-picpre-pullup show-thumb-icon" node-type="show-thumb-icon"></em>'),i.push("                  </div>"),i.push("</div>"),i.push("</div>"),i.push('<div class="thumb-wrap" node-type="thumb-wrap">'),i.push('<ol node-type="thumb-list" class="thumb-list">'),i.push("</ol>"),i.push("</div>"),i.push("</div>"),o.exports=i.join("\n")});
;define("file-widget-1:image/util/picPreviewAside/picPreviewAside.tpl.js",function(i,s,e){var d=i("file-widget-1:image/context.js"),p=d.getContext;e.exports=function(){var i=[],s=p().pageInfo.currentPage;if(/^share-/.test(s))i.push('<div node-type="module" class="module-picPreviewAside" id="picPreviewAside">'),i.push('     <div class="box" node-type="box">'),i.push('         <div class="file-info" node-type="file-info">'),i.push('                <div class="title" node-type="title">照片详情</div>'),i.push("                <div>"),i.push('                    <div style="margin-top: 60px">'),i.push('                        <div class="detail-left">文件名</div>'),i.push('                        <div class="detail-right">'),i.push('                            <div node-type="filename" class="filename-info"></div>'),i.push("                        </div>"),i.push("                    </div>"),i.push("                    <div>"),i.push('                        <div class="detail-left">大小</div>'),i.push('                        <div class="detail-right">'),i.push('                            <div class="size-info" node-type="size"></div>'),i.push('                            <div class="size-info" node-type="capacity"></div>'),i.push("                        </div>"),i.push("                    </div>"),i.push('                <div class="retract-hide icon icon-picpre-close" node-type="retract"></div>'),i.push("        </div>"),i.push("     </div>"),i.push("</div>");else{i.push('<div node-type="module" class="module-picPreviewAside" id="picPreviewAside">'),i.push('     <div class="box" node-type="box">'),i.push('         <div class="file-info" node-type="file-info">'),i.push('                <div class="title" node-type="title">照片详情</div>'),i.push("                <div>"),i.push("                    <div>"),i.push('                        <div node-type="sculpture-top" class="detail-top">人脸</div>'),i.push('                        <div node-type="sculpture-box" class="sculpture-box">');for(var e=0;6>e;e++)i.push('                        <div node-type="human-sculpture" class="sculpture-item">'),i.push('                            <a class="sculpture-area" target="_blank">'),i.push('                                <img class="sculpture-img">'),i.push("                            </a>"),i.push("                        </div>");i.push("                        </div>"),i.push('                        <div node-type="category-top" class="detail-top">分类</div>'),i.push('                        <div node-type="category-box" class="category-box">');for(var e=0;3>e;e++)i.push('                        <div class="category-detail">'),i.push('                            <a class="category-detail-info" target="_blank"></a>'),i.push("                        </div>");i.push("                        </div>"),i.push("                    </div>"),i.push('                    <div class="filename-box">'),i.push('                        <div class="detail-left">文件名</div>'),i.push('                        <div class="detail-right">'),i.push('                            <div node-type="filename" class="filename-info"></div>'),i.push("                        </div>"),i.push("                    </div>"),i.push('                    <div node-type="directory-box">'),i.push('                        <div class="detail-left-directory">所属文件夹</div>'),i.push('                        <div class="detail-right">'),i.push('                            <a node-type="directory" class="directory-info" target="_blank"></a>'),i.push("                        </div>"),i.push("                    </div>"),i.push("                    <div>"),i.push('                        <div class="detail-left">地点</div>'),i.push('                        <div class="detail-right">'),i.push('                                <a node-type="address" class="address-info" target="_blank"></a>'),i.push("                        </div>"),i.push("                    </div>"),i.push("                    <div>"),i.push('                        <div class="detail-left">时间</div>'),i.push('                        <div class="detail-right">'),i.push('                             <div node-type="date-pre" class="date-pre"></div>'),i.push('                             <div node-type="date-after" class="date-after"></div>'),i.push("                        </div>"),i.push("                    </div>"),i.push("                    <div>"),i.push('                        <div class="detail-left">大小</div>'),i.push('                        <div class="detail-right">'),i.push('                            <div class="size-info" node-type="size"></div>'),i.push('                            <div class="size-info" node-type="capacity"></div>'),i.push("                        </div>"),i.push("                    </div>"),i.push('                <div class="retract-hide icon icon-picpre-close" node-type="retract"></div>'),i.push("        </div>"),i.push("     </div>"),i.push("</div>")}return i.join("\n")}});
;define("file-widget-1:image/util/showPic/showPic.tpl.js",function(i,e,s){var p=[];p.push('<div class="module-showPic clearfix">'),p.push('    <div node-type="img-wrap" class="img-wrap">'),p.push('        <img src="#" node-type="viewpic-image" id="viewpic-image"/>'),p.push('        <img src="#" node-type="viewpic-image-substitute" id="viewpic-image-substitute"/>'),p.push("    </div>"),p.push('    <div node-type="img-nav" class="img-nav">'),p.push('    <div node-type="img-nav-left" class="img-nav-left" hidefocus=true>'),p.push('        <span node-type="pre-arrow" class="pre-arrow">'),p.push('            <em class="pre-arrow-content icon icon-picpre-before"></em>'),p.push("        </span>"),p.push("    </div>"),p.push('    <div node-type="img-nav-right" class="img-nav-right" hidefocus=true>'),p.push('        <span node-type="next-arrow" class="next-arrow">'),p.push('            <em class="next-arrow-content icon icon-picpre-next"></em>'),p.push("        </span>"),p.push("        </div>"),p.push("    </div>"),p.push('    <div class="img-loading" node-type="img-loading"></div>'),p.push("</div>"),s.exports=p.join("")});
;define("file-widget-1:image/util/picPreview/picPreview.tpl.js",function(i,e,d){var o=[];o.push('<div node-type="dlg-hd" class="dlg-hd">'),o.push('    <a title="关闭" hideFocus=true id=<%=closeId%> class="dlg-img-ic dlg-img-close icon icon-picpre-close"></a>'),o.push("</div>"),o.push('<div node-type="dlg-two-dimension" class="dlg-two-dimension">'),o.push('    <a title="手机安装入口" class="dlg-phone-ic icon icon-picpre-phone" node-type="downloadText"></a>'),o.push("</div>"),d.exports=o.join("\n")});
;define("file-widget-1:image/log.js",function(i,e,c){c.exports={mix:{show_imgLoad:{logType:"time",description:"浏览图片"},picpreview_face_search_click:{logType:"count",description:"点击人脸搜索按钮的次数"},picpreview_print_pic:{logType:"count",description:"点击云冲印按钮的次数"},picpreview_large_pic_click:{logType:"count",description:"点击放大按钮的次数"},picpreview_control_left_click:{logType:"count",description:"点击左旋转按钮的次数"},"picpreview_picpreview_control_share-click":{logType:"count",description:"点击分享按钮的次数"},picpreview_control_download_click:{logType:"count",description:"点击下载按钮的次数"},picpreview_control_edit_click:{logType:"count",description:"点击美化按钮的次数"},picpreview_control_delete_click:{logType:"count",description:"点击删除按钮的次数"},picpreview_control_reappear_click:{logType:"count",description:"点击图片详情按钮的次数"},picpreview_open_detail_click:{logType:"count",description:"点击打开图片详情的次数"},picpreview_close_detail_click:{logType:"count",description:"点击关闭图片详情的次数"},picpreview_open_directory_click:{logType:"count",description:"点击所属文件夹的次数"},picpreview_open_category_click:{logType:"count",description:"点击所属分类的次数"},picpreview_disk_home_click:{logType:"count",description:"用户从文件列表中预览图片的次数"},picpreview_timeline_click:{logType:"count",description:"用户从云图中预览图片的次数"},picpreview_bigPic_loadtime:{logType:"time",description:"大图预览的加载时长"}}}});
;define("file-widget-1:image/start.js",function(e,i,t){var s=e("file-widget-1:image/context.js"),r=e("base:widget/libs/jquerypacket.js"),n=e("file-widget-1:image/util/picPreview/picPreview.js"),o=e("base:widget/storage/storage.js"),a=window.yunData,l={CATEGORY_PIC:3,picFileList:[],newArray:[],resetPicFileList:function(){this.picFileList=[]},showPic:function(e,i,t){var r=this,o=s.getContext(),a=t?t:o.list.getCurrentList()||[e],l=(s.getVersion(),s.getContext().pageInfo.currentPage),c=l&&/^share-/.test(l);this.resetPicFileList();for(var f,g=0,u=0,w=0;w<a.length;w++)f=a[w],+f.category===this.CATEGORY_PIC&&(this.picFileList.push(f),f===e&&(u=g),g++);"unzip"===i&&(u=0,this.picFileList.push(e)),n.showPicture({index:u,list:r.picFileList,hideMeta:c,from:i})},addListen:function(){var e;return function(){e=s.getContext(),e.message.listen("delete_picPreview",function(i){var t=l.newArray.length>0?l.newArray:l.picFileList;if(window.location.href.indexOf("disk/timeline")>0){if("function"==typeof l.refresh){var s,n=parseInt(i.index,10);for(l.newArray=[],s=0;s<t.length;s++)s!==n&&l.newArray.push(t[s]);l.refresh([i.file])}}else{var s,o=e.list.getIndexsByFiles([i.file]),n=parseInt(i.index,10);for(l.newArray=[],s=0;s<t.length;s++)s!==n&&l.newArray.push(t[s]);e.file.remove(o),e.list.refresh()}return 0===l.newArray.length?(r(".dlg-img-close").click(),!1):void i.callback(l.newArray)})}}(),getApiVersion:function(){if(null===s.getVersion()){var e="api_version_"+a.MYUK,i=new RegExp("^true_\\d*$"),t=i.test(o.getItem(e));t?s.setVersion(t):r.ajax({url:"/aipic/image/config",dataType:"json",async:!1,timeout:3e3,success:function(e){s.setVersion(e.newversion)},error:function(){s.setVersion(null)}})}}};t.exports.start=function(i,t){s.setContext(i),l.getApiVersion(),l.newArray=[];var r=[],n=null;if(r="object"==typeof t&&t.filesList?t.filesList.length>0?t.filesList:[t.filesList]:i.list.getSelected(),"object"==typeof t&&t.refresh&&(l.refresh=t.refresh),!(r.length>=1))throw new Error("[Plugin][preview/image] The filesList must have one file at least !");return n=r[0],"classify"===t.from?void e.async("file-widget-1:image/util/picCategory-dialog/picCategory-dialog.js",function(e){new e(r)}):("object"==typeof t?l.showPic(n,t.from,t.listsData):l.showPic(n),void(i.message.exist("delete_picPreview")||l.addListen()))}});