define("file-widget-1:codeReader/context.js",function(e,n,t){var o={context:null};t.exports={getContext:function(){return o.context},setContext:function(e){function n(n){var t;t=n.successed?"codeReader_preview_successed":"codeReader_preview_failed",e.log.send({type:t,msg:n.msg||"",sendPageFrom:!0})}o.context||(o.context=e,e.message.listen("codeReader_send_log",function(t){n(t),e.message.remove("codeReader_send_log")}),e.message.listen("rollback",function(n){e.message.callPlugin("网盘文档阅读器@com.baidu.pan",n)}))}}});
;define("file-widget-1:codeReader/util/codeReader.js",function(e,o,s){var i=e("file-widget-1:codeReader/context.js"),t=e("base:widget/libs/jquerypacket.js"),n={text:"shBrushPlain.js",sh:"shBrushBash.js",c:"shBrushCpp.js",cpp:"shBrushCpp.js",css:"shBrushCss.js",pas:"shBrushDelphi.js",diff:"shBrushDiff.js",patch:"shBrushDiff.js",erl:"shBrushErlang.js",groovy:"shBrushGroovy.js",java:"shBrushJava.js",jsp:"shBrushJava.js",js:"shBrushJScript.js",json:"shBrushJScript.js",pl:"shBrushPerl.js",php:"shBrushPhp.js",py:"shBrushPython.js",rb:"shBrushRuby.js",sass:"shBrushSass.js",scss:"shBrushSass.js",scala:"shBrushScala.js",sql:"shBrushSql.js",vb:"shBrushVb.js",xml:"shBrushXml.js",xhtml:"shBrushXml.js",html:"shBrushXml.js",htm:"shBrushXml.js"},r={conf:{param:{},isLoading:!1,dialog:null,currentFile:null,isShare:!1,sharePreDom:null,filePreDOM:null,brushs:"",fileName:"",fileType:"",code:""},util:{init:function(e){if(r.conf.dialog)e();else{var o=t(window).height()-20;o=440>o?440:o,o=o>640?640:o;var s=i.getContext();r.conf.filePreDOM=t('<div id="codeReaderController" style="height:'+(o-45)+'px" class="code-reader-container"></div>'),r.conf.filePreDOM.on("click","a",function(){return!1}),r.conf.dialog=s.ui.window({id:"codeReaderDialog",className:"code-reader-dialog",title:"",body:r.conf.filePreDOM,width:900,height:o,onClose:function(){r.util.clean()}}),r.conf.modeSwitchBtn=s.ui.button({name:"mode-switch",title:"",click:function(){r.util.modeSwitch()}}),r.conf.modeSwitchBtn.dom.addClass("mode-switch-button").hide(),r.conf.dialog.$header.append(r.conf.modeSwitchBtn.dom),t.getScript("/box-static/base/thirdParty/SyntaxHighlighter/_nomd5_nomod/scripts/shCore.js",e).error(function(){r.conf.isLoading=!1,s.ui.tip({mode:"caution",msg:"加载失败，请稍后重试"}),s.message.trigger("codeReader_send_log",{successed:!1,msg:"加载失败，请稍后重试"})})}},modeSwitch:function(){var e=r.conf.modeSwitchBtn.dom;"source"===e.data("mode")?e.data("mode","preview"):e.data("mode","source"),r.util.processCode(r.conf.fileName,r.conf.fileType,r.conf.originCode)},readfile:function(e){var o=i.getContext(),s=r.conf.currentFile.server_filename,n=s.match(/\.([\w\d]+)$/);return s&&n?(n=n[1].toLowerCase(),o.ui.tip({mode:"loading",msg:"正在加载数据...",autoClose:!1}),void t.ajax({url:e,type:"GET",dataType:"text",xhrFields:{withCredentials:!0},timeout:1e4,success:function(e){r.conf.isLoading=!1;var i=/\ufffd/g;return i.test(e)?"txt"===n?void o.message.callPlugin("网盘文档阅读器@com.baidu.pan",r.conf.param):(o.ui.tip({mode:"caution",msg:"暂不支持此编码格式预览"}),void o.message.trigger("codeReader_send_log",{successed:!1,msg:"暂不支持此编码格式预览"})):void r.util.processCode(s,n,e)},error:function(){r.conf.isLoading=!1,o.ui.tip({mode:"caution",msg:"文件加载失败"}),o.message.trigger("codeReader_send_log",{successed:!1,msg:"文件加载失败"})}})):(o.ui.tip({mode:"caution",msg:"暂不支持此文档格式预览"}),void(r.conf.isLoading=!1))},processCode:function(e,o,s){r.conf.fileName=e,r.conf.fileType=o,r.conf.originCode=s;var a=i.getContext();if("text"!==o&&n[o])r.conf.dialog.title(e+" - 代码阅读");else if("md"===o){if("source"!==r.conf.modeSwitchBtn.dom.data("mode")){r.conf.dialog.title(e),r.conf.modeSwitchBtn.dom.show().find(".text").text("源码模式");var d=function(){a.ui.hideTip();var e=window.markdownit();r.conf.isShare?r.conf.sharePreDom.addClass("markdown-body").html(e.render(s)):(r.conf.filePreDOM.addClass("markdown-body").html(e.render(s)),r.conf.dialog.show()),a.message.trigger("codeReader_send_log",{successed:!0})};return void(window.markdownit?d():t.getScript("/box-static/base/thirdParty/markdown/_nomd5_nomod/markdown-it.js",function(){d()}).error(function(){a.ui.tip({mode:"caution",msg:"加载失败，请稍后重试"}),a.message.trigger("codeReader_send_log",{successed:!1,msg:"加载失败，请稍后重试"})}))}r.conf.dialog.title(e+" - 源码阅读"),r.conf.modeSwitchBtn.dom.show().find(".text").text("预览模式"),o="text"}else r.conf.dialog.title(e+" - 文本阅读"),o="text";s=s.replace(/</g,"&lt;").replace(/>/g,"&gt;");var c='<pre class="brush: '+o+';">'+s+"</pre>";r.util.formatCode(o,c)},clean:function(){r.conf.dialog.title(""),r.conf.filePreDOM.html(""),r.conf.modeSwitchBtn.dom.data("mode","").hide()},formatCode:function(e,o){var s=n[e],a=i.getContext(),d=function(){a.ui.hideTip(),r.conf.isShare?r.conf.sharePreDom.removeClass("markdown-body").css("visibility","hidden").html(o):r.conf.filePreDOM.removeClass("markdown-body").css("visibility","hidden").html(o),window.SyntaxHighlighter.highlight({toolbar:!1,"auto-links":!1,"quick-code":!1}),r.conf.isShare?r.conf.sharePreDom.css("visibility","visible"):(r.conf.filePreDOM.css("visibility","visible"),r.conf.dialog.show()),a.message.trigger("codeReader_send_log",{successed:!0})};if(-1===r.conf.brushs.indexOf(s)){var c="/box-static/base/thirdParty/SyntaxHighlighter/_nomd5_nomod/scripts/";t.getScript(c+s,function(){r.conf.brushs+=s,d()})}else d()}}};s.exports=function(e,o){o.param&&(r.conf.param=o.param),r.conf.isLoading||(r.conf.isLoading=!0,r.conf.currentFile=e,o.dom?(r.conf.isShare=!0,r.conf.sharePreDom=t(o.dom).on("click","a",function(){return!1}).on("mousewheel DOMMouseScroll",function(e){var o=0;e.originalEvent.wheelDelta&&(o=e.originalEvent.wheelDelta),e.originalEvent.detail&&(o=e.originalEvent.detail);var s=t(this).scrollTop();return o>0&&0===s?!1:0>o&&s+t(this).height()+1>=this.scrollHeight?!1:void 0}).addClass("code-reader-container")):r.conf.isShare=!1,r.util.init(function(){r.util.readfile(e.dlink)}))}});
;define("file-widget-1:codeReader/start.js",function(e,i,t){var s=e("file-widget-1:codeReader/context.js"),a=e("file-widget-1:codeReader/util/codeReader.js"),n=window.yunData,r=1048576;t.exports.start=function(e,i){function t(t){l.dlink="",l.dlink=t.dlink?t.dlink[0].dlink:t.list[0].dlink,l.dlink+=-1==l.dlink.indexOf("?")?"?":"&",l.dlink+="use=1",e.ui.hideTip(),a(l,{param:i,flag:i&&i.flag,dom:i&&i.dom})}var d;if(s.setContext(e),d="object"==typeof i&&i.filesList?i.filesList.length>0?i.filesList:[i.filesList]:e.list.getSelected(),1!==d.length)throw new Error("[Plugin][file-widget-1/codeReader] The filesList must have one file !");var l=d[0],o=l.server_filename.match(/\.([\w\d]+)$/);if(o=o.length&&o[1],"txt"===o.toLowerCase()&&l.size>r)return void e.message.callPlugin("网盘文档阅读器@com.baidu.pan",i);if(l.size>r)return e.ui.tip({mode:"caution",msg:"文件过大，无法预览"}),e.message.trigger("codeReader_send_log",{successed:!1,msg:"文件过大，无法预览"}),void(e.libs._.isFunction(i.errorCallBack)&&i.errorCallBack("1"));e.ui.tip({mode:"loading",msg:"正在加载数据..."});var c="share",u={};"share"===e.pageInfo.currentProduct?u={list:[l],product:i&&"unzip"===i.from?"pan":e.pageInfo.currentProduct,hasDlink:!1,share_uk:n.SHARE_UK,share_id:n.SHARE_ID,sign:n.SIGN,timestamp:n.timestamp,type:"nolimit"}:"sharedir"===e.router.currentRouteName?u={path:[l],product:"sf",hasDlink:!0,share_uk:n.MYUK,share_id:l.fs_id,sign:n.sign1,timestamp:n.timestamp,type:"nolimit"}:(c="normal",u=[l.fs_id]),e.message.callPlugin("网盘下载@com.baidu.pan",{run:"getDownloadLink",config:u,callback:t,type:c})}});